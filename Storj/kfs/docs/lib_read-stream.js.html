<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/read-stream.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/read-stream.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const {Readable: ReadableStream} = require('readable-stream').Readable;
const utils = require('./utils');

/**
 * Creates a readable stream of a file from a {@link Sbucket}
 */
class ReadableFileStream extends ReadableStream {

  /**
   * @constructor
   * @param {Object} options
   * @param {Sbucket} options.sBucket
   * @param {String} options.fileKey
   */
  constructor(options) {
    super();
    this._sBucket = options.sBucket;
    this._fileKey = options.fileKey;
    this._index = 0;
  }

  /**
   * Triggered when data is available to read
   * @event ReadableFileStream#readable
   */

  /**
   * Triggered when a data is pushed through the stream
   * @event ReadableFileStream#data
   * @param {Buffer} bytes
   */

  /**
   * Triggered when no more data is available
   * @event ReadableFileStream#end
   */

  /**
   * Triggered if an error occurs
   * @event ReadableFileStream#error
   * @param {Error} error
   */

  /**
   * @private
   */
  _read() {
    const itemKey = utils.createItemKeyFromIndex(this._fileKey, this._index);

    this._sBucket._db.get(itemKey, (err, result) => {
      if (err) {
        if (utils.isNotFoundError(err)) {
          return this.push(null);
        } else {
          return this.emit('error', err);
        }
      }

      this._index++;
      this.push(Buffer(result, 'binary'));
    });
  }

  /**
   * Destroys and aborts any reads for this stream
   * @param {Sbucket~unlinkCallback}
   */
  destroy(callback) {
    this._sBucket.unlink(this._fileKey, callback);
  }

}

module.exports = ReadableFileStream;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-kfs.html">kfs</a></li><li><a href="module-kfs_constants.html">kfs/constants</a></li><li><a href="module-kfs_utils.html">kfs/utils</a></li></ul><h3>Classes</h3><ul><li><a href="BlockStream.html">BlockStream</a></li><li><a href="Btable.html">Btable</a></li><li><a href="ReadableFileStream.html">ReadableFileStream</a></li><li><a href="Sbucket.html">Sbucket</a></li><li><a href="WritableFileStream.html">WritableFileStream</a></li></ul><h3>Events</h3><ul><li><a href="BlockStream.html#event:data">data</a></li><li><a href="BlockStream.html#event:end">end</a></li><li><a href="ReadableFileStream.html#event:data">data</a></li><li><a href="ReadableFileStream.html#event:end">end</a></li><li><a href="ReadableFileStream.html#event:error">error</a></li><li><a href="ReadableFileStream.html#event:readable">readable</a></li><li><a href="Sbucket.html#event:close">close</a></li><li><a href="Sbucket.html#event:idle">idle</a></li><li><a href="Sbucket.html#event:locked">locked</a></li><li><a href="Sbucket.html#event:open">open</a></li><li><a href="Sbucket.html#event:unlocked">unlocked</a></li><li><a href="WritableFileStream.html#event:error">error</a></li><li><a href="WritableFileStream.html#event:finish">finish</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-about.html">Motivation and Mechanics</a></li><li><a href="tutorial-cli.html">Command Line Interface</a></li><li><a href="tutorial-kfs.html">Programmatic Usage</a></li><li><a href="tutorial-performance-testing.html">Performance Testing the Changes</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Sat Nov 09 2024 15:21:40 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
